<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>培训师</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!-- 正式环境下压缩的代码 -->
    <link rel="stylesheet" href="http://g.alicdn.com/sui-mobile/sm/0.5.0/css/sm.min.css">
    <!--如果你用到了拓展包中的组件，还需要引用下面两个 -->
    <link rel="stylesheet" href="http://g.alicdn.com/sui-mobile/sm/0.5.0/css/sm-extend.min.css">

    <link rel="stylesheet" href="http://libs.baidu.com/fontawesome/4.0.3/css/font-awesome.min.css"/>

    <!-- 开发环境下调试代码 -->
    <!--<link rel="stylesheet" href="http://g.alicdn.com/sui-mobile/sm/0.5.0/css/sm.css">-->
    <!--如果你用到了拓展包中的组件，还需要引用下面两个-->
    <!--<link rel="stylesheet" href="http://g.alicdn.com/sui-mobile/sm/0.5.0/css/sm-extend.css">-->
    <!-- my css -->
    <style type="text/css">
        body, button, input, select, textarea {
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            -moz-font-feature-settings: "liga","kern";
        }
        body {
            margin: 0;
            background: #fff;
            font-family: "Segoe UI","Lucida Grande",Helvetica,Arial,"Microsoft YaHei",FreeSans,Arimo,"Droid Sans","wenquanyi micro hei","Hiragino Sans GB","Hiragino Sans GB W3",FontAwesome,sans-serif;
            font-weight: 400;
            color: #333;
        }
        body, pre {
            line-height: 1.6;
        }

        .avatar {
            width: 3.5rem;
            height: 3.5rem;
            -webkit-border-radius: 50%;
            -moz-border-radius: 50%;
            border-radius: 50%;
        }
        .list-block.media-list .item-title, .list-block li.media-item .item-title {
            font-weight: bold;
        }
        .item-media { position: absolute; }
        .list-block .item-media + .item-inner {
            margin-left: 5rem;
            padding-right: 1.9rem;
        }
        .list-block .item-subtitle { font-weight: bold; }
        .list-block, .list-block .item-subtitle { font-size: .92rem; }
        .list-block.media-list .item-media, .list-block li.media-item .item-media { padding-top: .6rem; padding-right: 1rem; }
        .item-title-row {
            margin-bottom: .2rem;
        }
        .item-description {
            color: #989898;
            font-size: .62rem;
            margin-top: .3rem;
            margin-bottom: .2rem;
            text-align: justify;
        }

        .list-block .item-content {
            padding-left: .9rem;
        }
        .list-block .item-content-top {
            min-height: 7.32rem;
        }
        .item-price {
            position: absolute;
            left: 0rem;
            margin-top: 3.8rem;
            color: rgb(255,130,97);
            font-size: .75rem;
        }
        .item-price-free {
            text-align: center;
        }
        .item-price-per {
            color: #989898;
            margin-top: -.2rem;
            text-decoration: line-through;
        }
        .item-hr {
            width: 100%;
            height: 1px;
            border-bottom: 1px solid #e7e7e7;
        }
        .list-block .item-media + .item-inner-date {
            padding-right: 1.1rem;
            padding-top: 0;
        }
        .list-block .item-inner:after {
            background-color: transparent;
        }
        .date-date {
            position: absolute;
            left: -5.3rem;
        }
        .date-date-calendar {
            font-size: 1.19rem;
            font-weight: bold;
            color: #02b218;
        }
        .date-date-which {
            text-align: center;
            font-size: .75rem;
            font-weight: bold;
            margin-top: -.3rem;
        }
        .date-date-right-container {
            padding-top: .5rem;
        }
        .list-block ul ul.date-list {
            padding-left: 0;
        }

        .date-list-item-time {
            font-size: .75rem;
            color: #989898;
            margin-bottom: .5rem;
        }
        .date-list-item-time-active {
            font-weight: bold;
            color: #252525;
        }
        .date-list-item-btn-div {
            position: absolute;
            right: 0;
            margin-top: -1.7rem;
        }
        .button-success {
            color: #fff;
            border-color: #02b218;
            background-color: rgb(2, 178, 24);
        }
        .button.disabled, .button.button-primary.disabled, .button.button-success.disabled, .button.button-danger.disabled, .button.button-warning.disabled {
            color: #fff;
            cursor: not-allowed;
            border-color: rgb(182, 182, 182);
            background-color: rgb(194, 194, 194);
        }
        .button.button-big {
            height: 1.8rem;
            font-size: .85rem;
            line-height: 1.7rem;
        }
        .date-date-big-btn-wrapper {
            padding-top: .2rem;
        }
        .list-block .item-media + .item-inner-date-today {
            padding-bottom: 0;
        }
        .card-content {
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        .bar-tab .tab-item.active, .bar-tab .tab-item:active {
            color: #02b218;
            border-top: 3px solid #02b218;
        }
        .bar-nav {
            background-color: #02b218;
        }
        .title, .bar .button-link {
            color: #fff;
        }
        .title {
            font-weight: bold;
        }
        .modal-button {
            color: #02b218;
        }

        input.modal-text-input {
            padding: 1rem .6rem;
            font-size: .8rem;
            color: #555;
            vertical-align: middle;
            background-color: #fff;
            background-image: none;
            border: 1px solid #ccc;
            border-radius: 0;
            -webkit-appearance: none;
            -webkit-transition: border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
            transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
        }

        .modal {
            width: 15.5rem;
            margin-left: -7.75rem;
        }
        .modal-close {
            position: absolute;
            right: 0;
            font-size: 1.1rem;
            color: #999;
            margin-top: -.7rem;
            height: 2rem;
            width: 2rem;
            text-align: center;
        }

        .list-block ul ul.date-list-collapse {
            margin-top: .5rem;
            overflow: hidden;
            height: 0;
        }

        .animate-gpu {
            -webkit-transform: translateZ(0);
            -moz-transform: translateZ(0);
            -ms-transform: translateZ(0);
            -o-transform: translateZ(0);
            transform: translateZ(0);

            -webkit-backface-visibility: hidden;
            -moz-backface-visibility: hidden;
            -ms-backface-visibility: hidden;
            backface-visibility: hidden;

            /*-webkit-transform: translate3d(0, 0, 0);
            -moz-transform: translate3d(0, 0, 0);
            -ms-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);*/
        }

        .card {
            -webkit-transition: all 2s;
            -moz-transition: all 2s;
            -ms-transition: all 2s;
            -o-transition: all 2s;
            transition: all 2s;
            margin-left: 0;
            margin-right: 0;
            margin-top: 0;
        }

        .date-btn, .button.disabled {
            width: 3.3rem;
        }
        .toast {
            height: auto;
            width: auto;
            max-width: 89%;
            padding: .4rem 1rem;
            border-radius: .2rem;
            line-height: 1.8rem;
            line-height: 1.2rem;
        }
    </style>
</head>
<body>
<div class="page page-current" id='trainerList'>
    <div class="content infinite-scroll pull-to-refresh-content" data-ptr-distance="55" data-distance="100">
        <!-- 默认的下拉刷新层 -->
        <div class="pull-to-refresh-layer">
            <div class="preloader"></div>
            <div class="pull-to-refresh-arrow"></div>
        </div>
        <div class="content-inner">

            <!-- 这里是页面内容区 -->
            <!--<div class="card">
                <div class="card-content">
                    <div class="list-block media-list">
                        <ul>
                            <li class="item-content item-content-top">
                                <div class="item-media">
                                    <img class="avatar" src="http://gqianniu.alicdn.com/bao/uploaded/i4//tfscom/i3/TB10LfcHFXXXXXKXpXXXXXXXXXX_!!0-item_pic.jpg_250x250q60.jpg">
                                </div>
                                <div class="item-inner">
                                    <div class="item-title-row">
                                        <div class="item-title">
                                            张晨
                                        </div>
                                    </div>
                                    <div class="item-subtitle">如何应对电话面试?</div>
                                    <div class="item-description">职业生涯规划师，5年从业经验，辅导过 1000+ 学生，擅长解决学生在面试中可能遇到的各种问题。</div>
                                    <div class="item-price">
                                        <div class="item-price-free">限时免费</div>
                                        <div class="item-price-per">100元 / 小时</div>
                                    </div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-media">

                                </div>
                                <div class="item-inner item-inner-date item-inner-date-today">
                                    <div class="item-hr"></div>
                                    <div class="date-date">
                                        <div class="date-date-calendar">07-18</div>
                                        <div class="date-date-which">今天</div>
                                    </div>
                                    <div class="date-date-right-container">
                                        <ul class="date-list">
                                            <li>
                                                <div class="date-list-item-time date-list-item-time-active">上午 8:00-9:00</div>
                                                <div class="date-list-item-btn-div"><a href="#" class="button button-success date-btn">预约</a></div>
                                            </li>
                                            <li>
                                                <div class="date-list-item-time">上午 9:00-10:00</div>
                                                <div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>
                                            </li>
                                            <li>
                                                <div class="date-list-item-time">下午 2:00-3:00</div>
                                                <div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>
                                            </li>
                                            <li>
                                                <div class="date-list-item-time">下午 4:00-5:00</div>
                                                <div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-media">

                                </div>
                                <div class="item-inner item-inner-date">
                                    <div class="date-date">
                                        <div class="date-date-calendar">07-19</div>
                                        <div class="date-date-which">明天</div>
                                    </div>
                                    <div class="date-date-right-container">
                                        <div class="date-date-big-btn-wrapper">
                                            <a href="#" class="date-collapse button button-success button-big">预约</a>
                                            <ul class="date-list date-list-collapse" style="opacity: 0; height: 0;">
                                                <li>
                                                    <div class="date-list-item-time date-list-item-time-active">上午 8:00-9:00</div>
                                                    <div class="date-list-item-btn-div"><a href="#" class="button button-success date-btn">预约</a></div>
                                                </li>
                                                <li>
                                                    <div class="date-list-item-time">上午 9:00-10:00</div>
                                                    <div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>
                                                </li>
                                                <li>
                                                    <div class="date-list-item-time">下午 2:00-3:00</div>
                                                    <div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>
                                                </li>
                                                <li>
                                                    <div class="date-list-item-time">下午 4:00-5:00</div>
                                                    <div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-media">

                                </div>
                                <div class="item-inner item-inner-date">
                                    <div class="date-date">
                                        <div class="date-date-calendar">07-20</div>
                                        <div class="date-date-which">后天</div>
                                    </div>
                                    <div class="date-date-right-container">
                                        <div class="date-date-big-btn-wrapper">
                                            <a href="#" class="date-collapse button disabled button-big">已满</a>
                                            <ul class="date-list date-list-collapse" style="opacity: 0; height: 0;">
                                                <li>
                                                    <div class="date-list-item-time date-list-item-time-active">上午 8:00-9:00</div>
                                                    <div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>
                                                </li>
                                                <li>
                                                    <div class="date-list-item-time">上午 9:00-10:00</div>
                                                    <div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>
                                                </li>
                                                <li>
                                                    <div class="date-list-item-time">下午 2:00-3:00</div>
                                                    <div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>
                                                </li>
                                                <li>
                                                    <div class="date-list-item-time">下午 4:00-5:00</div>
                                                    <div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>-->

            <!-- 加载提示符 -->
            <div class="infinite-scroll-preloader">
                <div class="preloader"></div>
                <div class="preloader-text">一大波培训师正在袭来，请稍候 ...</div>
            </div>
        </div>
    </div>
</div>

<!-- js 文件 -->
<!-- 正式环境下压缩的代码 -->
<!-- <script type='text/javascript' src='http://g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
<script type='text/javascript' src='http://g.alicdn.com/sui-mobile/sm/0.5.0/js/sm.min.js' charset='utf-8'></script>
<script type='text/javascript' src='http://g.alicdn.com/sui-mobile/sm/0.5.0/js/sm-extend.min.js' charset='utf-8'></script> -->
<!-- 开发环境下调试代码 -->
<script type='text/javascript' src='http://g.alicdn.com/sj/lib/zepto/zepto.js' charset='utf-8'></script>
<!--<script type='text/javascript' src='http://g.alicdn.com/sui-mobile/sm/0.5.0/js/sm.js' charset='utf-8'></script>-->
<script type='text/javascript' src='http://m.sui.taobao.org/dist/js/sm.js' charset='utf-8'></script>
<!--<script type='text/javascript' src='http://g.alicdn.com/sui-mobile/sm/0.5.0/js/sm-extend.js' charset='utf-8'></script>-->
<script type='text/javascript' src='http://m.sui.taobao.org/dist/js/sm-extend.js' charset='utf-8'></script>

<!-- my js -->
<script type="text/javascript">
    (function ($) {
        $(function() {
            //
            $(document).on('click', '.date-btn', function () {
                var $me = $(this);
                $me.addClass('dating');
                var trainer_time_id = $me.attr('data-trainer-time-id');
                var trainer_id = $me.attr('data-trainer-id');
                if($me.hasClass('dated')) {
                    $.confirm('确定要取消预约？', function () {
                        var trainerTimeId = $me.attr('data-trainer-time-id');
                        var trainerId = $me.attr('data-trainer-id');
                        $.ajax({
                            type: "post",
                            url: '/index.php/Trainer/cancel_appoint',
                            // url: 'cancel_appoint',
                            async: false, // 使用同步方式
                            // 1 需要使用JSON.stringify 否则格式为 a=2&b=3&now=14...
                            // 2 需要强制类型转换，否则格式为 {"a":"2","b":"3"}
                            data: JSON.stringify({
                                token: infiniteScrollLoader.token,
                                trainer_id: trainerId,
                                trainer_time_id: trainerTimeId
                            }),
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function(jData) {
                                if(jData.code != 0) {
                                    // $.toast('取消预约失败');
                                    $.toast(jData.desc);
                                    $('.date-btn.dating').removeClass('dating');
                                    return;
                                }
                                $me.text('取消预约成功');
                                var datingBtn = $('.date-btn.dating').text('预约').removeClass('dating').removeClass('dated');
                                datingBtn.parents('.date-date-big-btn-wrapper').find('.date-collapse').removeClass('disabled').addClass('button-success').html('预 &nbsp;  &nbsp; 约');
                                $.closeModal();
                                $.toast(jData.desc);
                            } // 注意不要在此行增加逗号
                        });
                    });
                    return ;
                }
                /*$.prompt('培训师会在约定时间与您联系', function (value) {
                    $.alert('您输入的是 “' + value + '”。');
                });
                $('.modal-text-input').attr('placeholder', '请输入您的电话号码');*/
                var dataStr = ['data-trainer-time-id="', trainer_time_id, '" data-trainer-id="', trainer_id, '"'].join('');
                $.modal({
                    text:   ['<div style="text-align: left; font-size: .6rem;">培训师会在约定时间与您联系<span class="modal-close">×</span></div>',
                            '<input id="ds-name" style="margin-top: .57rem;" placeholder="请输入您的姓名" type="text" class="modal-text-input">',
                            '<input id="ds-phone" style="margin-top: .54rem;" placeholder="请输入您的电话号码" type="text" class="modal-text-input">',
                            '<div style="margin-top: .7rem;" class="row">',
                                '<div class="col-100"><a id="date-submit" ', dataStr,' style="height: auto;" href="#" class="button button-big button-success">确定</a></div>',
                            '</div>'].join('')
                });
            });
            //
            ;(function($, undefined){
                var prefix = '', eventPrefix,
                        vendors = { Webkit: 'webkit', Moz: '', O: 'o' },
                        testEl = document.createElement('div'),
                        supportedTransforms = /^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,
                        transform,
                        transitionProperty, transitionDuration, transitionTiming, transitionDelay,
                        animationName, animationDuration, animationTiming, animationDelay,
                        cssReset = {}

                function dasherize(str) { return str.replace(/([a-z])([A-Z])/, '$1-$2').toLowerCase() }
                function normalizeEvent(name) { return eventPrefix ? eventPrefix + name : name.toLowerCase() }

                $.each(vendors, function(vendor, event){
                    if (testEl.style[vendor + 'TransitionProperty'] !== undefined) {
                        prefix = '-' + vendor.toLowerCase() + '-'
                        eventPrefix = event
                        return false
                    }
                })

                transform = prefix + 'transform'
                cssReset[transitionProperty = prefix + 'transition-property'] =
                        cssReset[transitionDuration = prefix + 'transition-duration'] =
                                cssReset[transitionDelay    = prefix + 'transition-delay'] =
                                        cssReset[transitionTiming   = prefix + 'transition-timing-function'] =
                                                cssReset[animationName      = prefix + 'animation-name'] =
                                                        cssReset[animationDuration  = prefix + 'animation-duration'] =
                                                                cssReset[animationDelay     = prefix + 'animation-delay'] =
                                                                        cssReset[animationTiming    = prefix + 'animation-timing-function'] = ''

                $.fx = {
                    off: (eventPrefix === undefined && testEl.style.transitionProperty === undefined),
                    speeds: { _default: 400, fast: 200, slow: 600 },
                    cssPrefix: prefix,
                    transitionEnd: normalizeEvent('TransitionEnd'),
                    animationEnd: normalizeEvent('AnimationEnd')
                }

                $.fn.animate = function(properties, duration, ease, callback, delay){
                    if ($.isFunction(duration))
                        callback = duration, ease = undefined, duration = undefined
                    if ($.isFunction(ease))
                        callback = ease, ease = undefined
                    if ($.isPlainObject(duration))
                        ease = duration.easing, callback = duration.complete, delay = duration.delay, duration = duration.duration
                    if (duration) duration = (typeof duration == 'number' ? duration :
                                    ($.fx.speeds[duration] || $.fx.speeds._default)) / 1000
                    if (delay) delay = parseFloat(delay) / 1000
                    return this.anim(properties, duration, ease, callback, delay)
                }

                $.fn.anim = function(properties, duration, ease, callback, delay){
                    var key, cssValues = {}, cssProperties, transforms = '',
                            that = this, wrappedCallback, endEvent = $.fx.transitionEnd,
                            fired = false

                    if (duration === undefined) duration = $.fx.speeds._default / 1000
                    if (delay === undefined) delay = 0
                    if ($.fx.off) duration = 0

                    if (typeof properties == 'string') {
                        // keyframe animation
                        cssValues[animationName] = properties
                        cssValues[animationDuration] = duration + 's'
                        cssValues[animationDelay] = delay + 's'
                        cssValues[animationTiming] = (ease || 'linear')
                        endEvent = $.fx.animationEnd
                    } else {
                        cssProperties = []
                        // CSS transitions
                        for (key in properties)
                            if (supportedTransforms.test(key)) transforms += key + '(' + properties[key] + ') '
                            else cssValues[key] = properties[key], cssProperties.push(dasherize(key))

                        if (transforms) cssValues[transform] = transforms, cssProperties.push(transform)
                        if (duration > 0 && typeof properties === 'object') {
                            cssValues[transitionProperty] = cssProperties.join(', ')
                            cssValues[transitionDuration] = duration + 's'
                            cssValues[transitionDelay] = delay + 's'
                            cssValues[transitionTiming] = (ease || 'linear')
                        }
                    }

                    wrappedCallback = function(event){
                        if (typeof event !== 'undefined') {
                            if (event.target !== event.currentTarget) return // makes sure the event didn't bubble from "below"
                            $(event.target).unbind(endEvent, wrappedCallback)
                        } else
                            $(this).unbind(endEvent, wrappedCallback) // triggered by setTimeout

                        fired = true
                        $(this).css(cssReset)
                        callback && callback.call(this)
                    }
                    if (duration > 0){
                        this.bind(endEvent, wrappedCallback)
                        // transitionEnd is not always firing on older Android phones
                        // so make sure it gets fired
                        setTimeout(function(){
                            if (fired) return
                            wrappedCallback.call(that)
                        }, ((duration + delay) * 1000) + 25)
                    }

                    // trigger page reflow so new elements can animate
                    this.size() && this.get(0).clientLeft

                    this.css(cssValues)

                    if (duration <= 0) setTimeout(function() {
                        that.each(function(){ wrappedCallback.call(this) })
                    }, 0)

                    return this
                }

                testEl = null
            })(Zepto);
            //
            $(document).on('click', '#date-submit', function () {
                var $me = $(this);
                $me.text('预约中 ...');
                var trainerTimeId = $me.attr('data-trainer-time-id');
                var trainerId = $me.attr('data-trainer-id');
                //
                var name = $('#ds-name').val();
                var phone = $('#ds-phone').val();
                if(!name || name == '') {
                    $.toast('您还未输入姓名');
                    $me.text('确定');
                    return;
                }
                if(!phone || phone == '') {
                    $.toast('您还未输入电话号码');
                    $me.text('确定');
                    return;
                }
                if(!/((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/g.test(phone)) {
                    $.toast('您输入的电话号码有误，请检查');
                    $me.text('确定');
                    return;
                }
                //
                $.ajax({
                    type: "post",
                    url: '/index.php/Trainer/appoint',
                    // url: 'appoint',
                    async: false, // 使用同步方式
                    // 1 需要使用JSON.stringify 否则格式为 a=2&b=3&now=14...
                    // 2 需要强制类型转换，否则格式为 {"a":"2","b":"3"}
                    data: JSON.stringify({
                        token: infiniteScrollLoader.token,
                        trainer_id: trainerId,
                        trainer_time_id: trainerTimeId,
                        name: name,
                        phone: phone
                    }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function(jData) {
                        if(jData.code != 0) {
                            // $.alert('预约失败');
                            $.toast(jData.desc);
                            // $me.text('预约失败 ...');
                            $('.date-btn.dating').removeClass('dating');
                            return;
                        }
                        $me.text('预约成功');
                        var datingBtn = $('.date-btn.dating').text('已预约').removeClass('dating').addClass('dated');
                        $.closeModal();
                        // $.alert('预约成功');
                        // $.toast(jData.desc);
                        //
                        var dcBtn = datingBtn.parents('.date-date-big-btn-wrapper');
                        var dBtns = dcBtn.find('.date-btn');
                        var ddBtns = dcBtn.find('.date-btn.dated');
                        if(dBtns && ddBtns && dBtns.length <= ddBtns.length) {
                            dcBtn.find('.date-collapse').removeClass('button-success').addClass('disabled').html('已 &nbsp;  &nbsp; 满');
                        }
                    } // 注意不要在此行增加逗号
                });
            }).on('click', '.modal-close', function () {
                $.closeModal();
            }).on('click', '.date-collapse', function() {
                var thisDateCollapse = $(this);
                var dateList = thisDateCollapse.next('.date-list');
                var h = dateList.css('height').substr(0, 1);
                var animDuration = .1;
                if(h > 0) {
                    dateList.anim({height: 0}, animDuration);
                    // dateList.css('height', 0).css('transform', 'scale(1, 0)').css('opacity', 0);
                } else {
                    dateList.anim({height: thisDateCollapse.next('.date-list-collapse').data('height')}, animDuration);
                    // dateList.css('height', '6.6rem').css('transform', 'scale(1, 1)').css('opacity', 1);
                }
            });
            //
            Number.prototype.pad2 = function() {
                return this>9?this:'0'+this;
            }

            Date.prototype.format=function (format) {
                var it=new Date();
                var it=this;
                var M=it.getMonth()+1,H=it.getHours(),m=it.getMinutes(),d=it.getDate(),s=it.getSeconds();
                var n={ 'yyyy': it.getFullYear(),
                    'MM': M.pad2(),'M': M,
                    'dd': d.pad2(),'d': d,
                    'HH': H.pad2(),'H': H,
                    'mm': m.pad2(),'m': m,
                    'ss': s.pad2(),'s': s
                };
                return format.replace(/([a-zA-Z]+)/g,function (s,$1) { return n[$1]; });
            }
            //
            function getQueryString(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]); return null;
            }
            //
            var infiniteScrollLoader = {
                page: 1,
                limit: 3,
                genCollapseBtn: function (isAppoint) {
                    var cBtn;
                    switch (isAppoint) {
                        case 0: // 可预约
                            cBtn = '<a href="#" class="date-collapse button button-success button-big">预 &nbsp;  &nbsp; 约</a>';
                            break;
                        case 1: // 已预约
                            cBtn = '<a href="#" class="date-collapse button button-success button-big">已 &nbsp;  &nbsp; 预 &nbsp;  &nbsp; 约</a>';
                            break;
                        default:    // 已满
                            cBtn = '<a href="#" class="date-collapse button disabled button-big">已 &nbsp;  &nbsp; 满</a>';
                    }
                    return cBtn;
                },
                genListBtn: function (isAppoint, trainer_time_id, trainer_id) {
                    var dataStr = ['data-trainer-time-id="', trainer_time_id, '" data-trainer-id="', trainer_id, '"'].join('');
                    //
                    var cBtn;
                    switch (isAppoint) {
                        case 0: // 可预约
                            cBtn = ['<a href="#" class="button button-success date-btn" ', dataStr, '>预约</a>'].join('');
                            break;
                        case 1: // 已预约
                            cBtn = ['<a href="#" class="button button-success date-btn dated" ', dataStr, '>已预约</a>'].join('');
                            break;
                        default:    // 已满
                            cBtn = ['<a href="#" class="button disabled" ', dataStr, '>已满</a>'].join('');
                    }
                    return cBtn;
                },
                judgeMorningOrAfternoon: function (startTime) {
                    var preArr = startTime.split(':');
                    return (preArr[0] - 12 >= 0) ? '下午' : '上午';
                },
                parse12: function (timeStr) {
                    var timeStrArr = timeStr.split(':');
                    var hour = timeStrArr[0];
                    return [(hour > 12) ? (hour - 12) : (hour - 0), timeStrArr[1]].join(':');
                },
                genCard: function (curTrainer) {
                    var me = this;
                    var appoint_time = curTrainer.appoint_time;
                    var today = new Date();
                    var todayKey = today.format('MM-dd');
                    // console.log('todayKey: ' + todayKey);
                    // var tomorrow = new Date();
                    today.setDate(today.getDate() + 1);    // dd.setDate(dd.getDate()+AddDayCount)
                    var tomorrowKey = today.format('MM-dd');
                    // console.log('tomorrowKey: ' + tomorrowKey);
                    today.setDate(today.getDate() + 1);
                    var theDayAfterTomorrowKey = today.format('MM-dd');
                    // console.log('theDayAfterTomorrowKey: ' + theDayAfterTomorrowKey);
                    //
                    var todayLi = '';
                    var tomorrowLi = '';
                    var theDayAfterTomorrowLi = '';
                    if(appoint_time) {
                        if(appoint_time[todayKey]) {
                            var appointTimeToday = appoint_time[todayKey];
                            //
                            var info = appointTimeToday['info'];
                            var dateLiArr = [];
                            for(var idx in info) {
                                var curDate = info[idx];
                                var startTime = new Date(curDate.starttime * 1000).format('HH:mm');
                                dateLiArr.push('<li>',
                                        '<div class="date-list-item-time">', me.judgeMorningOrAfternoon(startTime),
                                        me.parse12(startTime),'-', me.parse12(new Date(curDate.endtime * 1000).format('HH:mm')),'</div>',
                                        '<div class="date-list-item-btn-div">', me.genListBtn(curDate.isappoint, curDate.id, curDate.trainer_id),'</div>',
                                        '</li>');
                            }
                            var dataHeight = [1.7 * dateLiArr.length / 10, 'rem'].join('');
                            //
                            todayLi = ['<li class="item-content">',
                                '<div class="item-media">',

                                '</div>',
                                '<div class="item-inner item-inner-date item-inner-date-today">',
                                '<div class="item-hr"></div>',
                                '<div class="date-date">',
                                '<div class="date-date-calendar">', todayKey, '</div>',
                                '<div class="date-date-which">今天</div>',
                                '</div>',
                                '<div class="date-date-right-container">',
                                me.genCollapseBtn(appointTimeToday['isappoint']),
                                '<ul class="date-list date-list-collapse" data-height="', dataHeight,'" style="height: ', dataHeight, ';">',
                                dateLiArr.join(''),
                                /*'<li>',
                                '<div class="date-list-item-time date-list-item-time-active">上午 8:00-9:00</div>',
                                '<div class="date-list-item-btn-div"><a href="#" class="button button-success date-btn">预约</a></div>',
                                '</li>',
                                '<li>',
                                '<div class="date-list-item-time">上午 9:00-10:00</div>',
                                '<div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>',
                                '</li>',
                                '<li>',
                                '<div class="date-list-item-time">下午 2:00-3:00</div>',
                                '<div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>',
                                '</li>',
                                '<li>',
                                '<div class="date-list-item-time">下午 4:00-5:00</div>',
                                '<div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>',
                                '</li>',*/
                                '</ul>',
                                '</div>',
                                '</div>',
                                '</li>',
                            ].join('');
                        }
                        if(appoint_time[tomorrowKey]) {
                            var appointTimeTomorrow = appoint_time[tomorrowKey];
                            //
                            var info = appointTimeTomorrow['info'];
                            var dateLiArr = [];
                            for(var idx in info) {
                                var curDate = info[idx];
                                var startTime = new Date(curDate.starttime * 1000).format('HH:mm');
                                dateLiArr.push('<li>',
                                        '<div class="date-list-item-time">', me.judgeMorningOrAfternoon(startTime),
                                        me.parse12(startTime),'-', me.parse12(new Date(curDate.endtime * 1000).format('HH:mm')),'</div>',
                                        '<div class="date-list-item-btn-div">', me.genListBtn(curDate.isappoint, curDate.id, curDate.trainer_id),'</div>',
                                        '</li>');
                            }
                            var dataHeight = [1.7 * dateLiArr.length / 10, 'rem'].join('');
                            //
                            tomorrowLi = ['<li class="item-content">',
                                '<div class="item-media">',

                                '</div>',
                                '<div class="item-inner item-inner-date">',
                                '<div class="date-date">',
                                '<div class="date-date-calendar">', tomorrowKey, '</div>',
                                '<div class="date-date-which">明天</div>',
                                '</div>',
                                '<div class="date-date-right-container">',
                                '<div class="date-date-big-btn-wrapper">',
                                me.genCollapseBtn(appointTimeTomorrow['isappoint']),
                                '<ul class="date-list date-list-collapse" data-height="', dataHeight,'">',
                                dateLiArr.join(''),
                                /*'<li>',
                                '<div class="date-list-item-time date-list-item-time-active">上午 8:00-9:00</div>',
                                '<div class="date-list-item-btn-div"><a href="#" class="button button-success date-btn">预约</a></div>',
                                '</li>',
                                '<li>',
                                '<div class="date-list-item-time">上午 9:00-10:00</div>',
                                '<div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>',
                                '</li>',
                                '<li>',
                                '<div class="date-list-item-time">下午 2:00-3:00</div>',
                                '<div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>',
                                '</li>',
                                '<li>',
                                '<div class="date-list-item-time">下午 4:00-5:00</div>',
                                '<div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>',
                                '</li>',*/
                                '</ul>',
                                '</div>',
                                '</div>',
                                '</div>',
                                '</li>'
                            ].join('');
                        }
                        if(appoint_time[theDayAfterTomorrowKey]) {
                            var appointTimeTheDayAfterTomorrow = appoint_time[theDayAfterTomorrowKey];
                            //
                            var info = appointTimeTheDayAfterTomorrow['info'];
                            var dateLiArr = [];
                            for(var idx in info) {
                                var curDate = info[idx];
                                var startTime = new Date(curDate.starttime * 1000).format('HH:mm');
                                dateLiArr.push('<li>',
                                        '<div class="date-list-item-time">', me.judgeMorningOrAfternoon(startTime),
                                        me.parse12(startTime),'-', me.parse12(new Date(curDate.endtime * 1000).format('HH:mm')),'</div>',
                                        '<div class="date-list-item-btn-div">', me.genListBtn(curDate.isappoint, curDate.id, curDate.trainer_id),'</div>',
                                        '</li>');
                            }
                            var dataHeight = [1.7 * dateLiArr.length / 10, 'rem'].join('');
                            //
                            theDayAfterTomorrowLi = ['<li class="item-content">',
                                '<div class="item-media">',

                                '</div>',
                                '<div class="item-inner item-inner-date">',
                                '<div class="date-date">',
                                '<div class="date-date-calendar">', theDayAfterTomorrowKey, '</div>',
                                '<div class="date-date-which">后天</div>',
                                '</div>',
                                '<div class="date-date-right-container">',
                                '<div class="date-date-big-btn-wrapper">',
                                me.genCollapseBtn(appointTimeTheDayAfterTomorrow['isappoint']),
                                '<ul class="date-list date-list-collapse" data-height="', dataHeight,'">',
                                dateLiArr.join(''),
                                /*'<li>',
                                '<div class="date-list-item-time">上午 8:00-9:00</div>',
                                '<div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>',
                                '</li>',
                                '<li>',
                                '<div class="date-list-item-time">上午 9:00-10:00</div>',
                                '<div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>',
                                '</li>',
                                '<li>',
                                '<div class="date-list-item-time">下午 2:00-3:00</div>',
                                '<div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>',
                                '</li>',
                                '<li>',
                                '<div class="date-list-item-time">下午 4:00-5:00</div>',
                                '<div class="date-list-item-btn-div"><a href="#" class="button disabled">已满</a></div>',
                                '</li>',*/
                                '</ul>'
                            ].join('');
                        }
                    }
                    //
                    return ['<div data-id="', curTrainer.id,'" style="opacity: 0; transform: translate(0, 25rem)" class="card">',
                                '<div class="card-content">',
                                        '<div class="list-block media-list">',
                                        '<ul>',
                                        '<li class="item-content item-content-top">',
                                        '<div class="item-media">',
                                        '<img class="avatar" src="', curTrainer.avatar,'">',
                                        '<div class="item-price">',
                                        '<div class="item-price-free">', (curTrainer.currentprice <= 0) ? '限时免费' : (curTrainer.currentprice + '元'),'</div>',
                                        '<div class="item-price-per">', curTrainer.originprice,'元/小时</div>',
                                        '</div>',
                                        '</div>',
                                        '<div class="item-inner">',
                                        '<div class="item-title-row">',
                                        '<div class="item-title">',
                                            curTrainer.name,
                                        '</div>',
                                        '</div>',
                                        '<div class="item-subtitle">', curTrainer.title,'</div>',
                                '<div class="item-description">', curTrainer.description,'</div>',
                                '</div>',
                                '</li>',
                                todayLi,
                                tomorrowLi,
                                theDayAfterTomorrowLi,
                                '</div>',
                                '</div>',
                                '</div>',
                                '</li>',
                                '</ul>',
                                '</div>',
                                '</div>',
                                '</div>'].join('');
                },
                isLoading: false,
                token: getQueryString('token'),
                city: getQueryString('city'),
                loadPage: function () {
                    if(this.isLoading) {
                        return ;
                    }
                    this.isLoading = true;
                    // Start: 从后端接口获取数据
                    var me = this;
                    $.ajax({
                        type: "post",
                        url: '/index.php/Trainer/get_list',
                        // url: 'get_list',
                        async: false, // 使用同步方式
                        // 1 需要使用JSON.stringify 否则格式为 a=2&b=3&now=14...
                        // 2 需要强制类型转换，否则格式为 {"a":"2","b":"3"}
                        data: JSON.stringify({
                            token: me.token,
                            city: me.city,
                            page: me.page,
                            limit: me.limit
                        }),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function(jData) {
                            if(jData.code != 0) {
                                var isPreLoader = $('.infinite-scroll-preloader');
                                isPreLoader.find('.preloader').anim({opacity: 0, display: 'none'});
                                isPreLoader.find('.preloader-text').text(jData.desc);
                                window.setTimeout(function () {
                                    isPreLoader.anim({opacity: 0}, undefined, undefined, function () {
                                        isPreLoader.hide();
                                    });
                                }, 2000);
                                return;
                            }
                            // ++me.page;
                            me.token = jData.token;
                            var trainerArr = jData.data;
                            // console.log(jData);
                            // console.log(trainerArr);
                            var htmlArr = [];
                            for(var i in trainerArr) {
                                var curTrainer = trainerArr[i];
                                htmlArr.push(me.genCard(curTrainer));
                            }
                            // 展示
                            $('.infinite-scroll-preloader').before(htmlArr.join(''));
                            setTimeout(function () {
                                // $('.card').css('opacity', 1).css('transform', 'translate(0, 0)');
                                $('.card').anim({opacity: 1, transform: 'translate(0, 0)'});
                            }, 10);
                            //
                            ++me.page;
                            //
                            if(trainerArr && trainerArr.length < me.limit) {
                                var isPreLoader = $('.infinite-scroll-preloader')
                                isPreLoader.anim({opacity: 0}, undefined, undefined, function () {
                                    isPreLoader.hide();
                                });
                                return;
                            }
                            //
                            me.isLoading = false;
                            //
                            if($('.infinite-scroll-preloader')[0].offsetTop < $('body').height()) {
                                infiniteScrollLoader.loadPage();
                            }
                        } // 注意不要在此行增加逗号
                    });
                    // End  : 从后端接口获取数据
                    /*var start = (this.page - 1) * this.limit + 1;
                    var end = this.page * this.limit;
                    var htmlArr = [this.genCard(start)];
                    for(var i = start + 1; i <= end; ++i) {
                        htmlArr.push(this.genCard(i));
                    }*/
                    // var me = this;
                    /*setTimeout(function () {
                        $('.infinite-scroll-preloader').before(htmlArr.join(''));
                        /!*var infiniteScrollPreloader = $('.infinite-scroll-preloader');
                        for(idx in htmlArr) {
                            var html = htmlArr[idx];
                            infiniteScrollPreloader.before(html);
                        }*!/
                        setTimeout(function () {
                            // $('.card').css('opacity', 1).css('transform', 'translate(0, 0)');
                            $('.card').anim({opacity: 1, transform: 'translate(0, 0)'});
                        }, 10);
                        //
                        ++me.page;
                        me.isLoading = false;
                    }, 1000);*/
                }
            };
            $('.infinite-scroll').scroll(function () {
                var distance = $(this).data('distance') || 80;
                if(($(this).scrollTop() + $(this).height()) > ($('.infinite-scroll-preloader')[0].offsetTop - distance)) {
                    infiniteScrollLoader.loadPage();
                }
            });
            infiniteScrollLoader.loadPage();
            $(document).on('touchend', '.modal-text-input', function() {
                $(this).parents('.modal').anim({
                    top: '8rem'
                });
            });
            //

            //
            /*function getList() {
                /!*$.ajax({
                    // url: 'http://101.200.176.248/index.php/Trainer/get_list',
                    url: 'get_list',
                    data: {
                        page: 1,
                        limit: 10,
                        token: 'DNkrQv2fXMr5h5THpDO4w91CYSuYmEdDlw9Dqo9hBMlPkR4g-XkItzKcoPCuAJ4rh3Wi6NvJNvfbNDQ_-5n0Ig%3D%3D'
                    },
                    // data: {token: "DNkrQv2fXMr5h5THpDO4w91CYSuYmEdDlw9Dqo9hBMlPkR4g-XkItzKcoPCuAJ4rh3Wi6NvJNvfbNDQ_-5n0Ig%3D%3D"},
                    type: 'POST',
                    /!*headers: {
                        "Access-Control-Allow-Origin":"http://example.edu",
                        "Access-Control-Allow-Headers":"X-Requested-With"
                    },*!/
                    contentType: 'application/json',
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                    }
                });*!/
                $.ajax({
                    type: "post",
                    // url: 'http://101.200.176.248/index.php/Trainer/get_list',
                    url: 'get_list',
                    async: false, // 使用同步方式
                    // 1 需要使用JSON.stringify 否则格式为 a=2&b=3&now=14...
                    // 2 需要强制类型转换，否则格式为 {"a":"2","b":"3"}
                    data: JSON.stringify({
                        token: 'DNkrQv2fXMr5h5THpDO4w91CYSuYmEdDlw9Dqo9hBMlPkR4g-XkItzKcoPCuAJ4rh3Wi6NvJNvfbNDQ_-5n0Ig%3D%3D'
                    }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function(jData) {
                        if(jData.code < 0) {
                            alert(jData.desc);
                            return;
                        }
                        var token = jData.token;
                        var data = jData.data;
                        console.log(jData);
                        console.log(data);
                    } // 注意不要在此行增加逗号
                });
            }*/
            // getList();
        });
    })(Zepto);
</script>
</body>
</html>
